syntax = "proto3";

package trading.v1.broker.handlers;

// GetRiskMetricsRequest queries portfolio risk metrics.
message GetRiskMetricsRequest {
  // Empty = all positions
  repeated string symbols = 1;
  // e.g., 0.95 for 95% VaR
  double confidence_level = 2;
  // Historical period
  int32 lookback_days = 3;
}

// GetRiskMetricsResponse returns risk calculations.
message GetRiskMetricsResponse {
  // Portfolio-level metrics
  // Value at Risk
  double portfolio_var = 1;
  // Sharpe ratio
  double portfolio_sharpe = 2;
  // Beta vs market
  double portfolio_beta = 3;
  // Maximum drawdown
  double max_drawdown = 4;

  // Position-level metrics
  map<string, PositionRisk> position_risks = 5; // Risk metrics by symbol

  // Correlation matrix (symbol pairs as keys)
  map<string, double> correlations = 6; // Pairwise correlations between positions

  // Timestamp of risk calculation in microseconds since epoch
  int64 timestamp_us = 7;
}

// PositionRisk contains risk metrics for a single position.
message PositionRisk {
  // Trading symbol identifier
  string symbol = 1;
  // Position Value at Risk
  double position_var = 2;
  // Beta relative to market
  double beta = 3;
  // Historical volatility
  double volatility = 4;
  // Dollar exposure
  double exposure = 5;
}
