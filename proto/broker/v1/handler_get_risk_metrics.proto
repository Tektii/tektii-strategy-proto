syntax = "proto3";

package broker.v1;

import "broker/v1/broker_common.proto";

// GetRiskMetricsRequest queries portfolio risk metrics.
message GetRiskMetricsRequest {
  // Empty = all positions
  repeated string symbols = 1;
  // e.g., 0.95 for 95% VaR
  PreciseDecimal confidence_level = 2;
  // Historical period
  int32 lookback_days = 3;
  // Broker to get risk metrics from (e.g., "alpaca", "interactive_brokers")
  Broker broker = 4;
}

// GetRiskMetricsResponse returns risk calculations.
message GetRiskMetricsResponse {
  // Portfolio-level metrics
  // Value at Risk
  PreciseDecimal portfolio_var = 1;
  // Sharpe ratio
  PreciseDecimal portfolio_sharpe = 2;
  // Beta vs market
  PreciseDecimal portfolio_beta = 3;
  // Maximum drawdown
  PreciseDecimal max_drawdown = 4;

  // Position-level metrics
  map<string, PositionRisk> position_risks = 5; // Risk metrics by symbol

  // Correlation matrix (symbol pairs as keys)
  map<string, PreciseDecimal> correlations = 6; // Pairwise correlations between positions

  // Timestamp of risk calculation in microseconds since epoch
  int64 timestamp_us = 7;
}

// PositionRisk contains risk metrics for a single position.
message PositionRisk {
  // Trading symbol identifier
  string symbol = 1;
  // Position Value at Risk
  PreciseDecimal position_var = 2;
  // Beta relative to market
  PreciseDecimal beta = 3;
  // Historical volatility
  PreciseDecimal volatility = 4;
  // Dollar exposure
  PreciseDecimal exposure = 5;
}
