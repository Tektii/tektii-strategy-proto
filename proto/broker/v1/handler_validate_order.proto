syntax = "proto3";

package broker.v1;

import "broker/v1/broker_common.proto";

// ValidateOrderRequest performs pre-trade validation.
message ValidateOrderRequest {
  // Trading symbol identifier
  string symbol = 1;
  // Buy or sell side
  OrderSide side = 2;
  // Type of order (market, limit, etc.)
  OrderType order_type = 3;
  // Order quantity
  PreciseDecimal quantity = 4;
  // Limit price for limit orders
  PreciseDecimal limit_price = 5;
  // Stop price for stop orders
  PreciseDecimal stop_price = 6;

  // Client-provided ID for request tracking
  string request_id = 7;

  // Broker to validate order with (e.g., "alpaca", "interactive_brokers")
  Broker broker = 8;
}

// ValidateOrderResponse returns validation results.
message ValidateOrderResponse {
  // Whether the order passes all validation checks
  bool valid = 1;
  // Echo of client request ID
  string request_id = 2;

  // Blocking validation errors
  repeated ValidationError errors = 3;
  // Non-blocking validation warnings
  repeated ValidationWarning warnings = 4;

  // Pre-trade risk check results
  RiskCheckResult risk_check = 5;

  // Market impact estimates
  // Estimated price at which order would fill
  PreciseDecimal estimated_fill_price = 6;
  // Estimated market impact of the order
  PreciseDecimal estimated_market_impact = 7;
}

// ValidationError represents a validation error that prevents order placement.
message ValidationError {
  // Field name that caused the error
  string field = 1;
  // Human-readable error message
  string message = 2;
  // Structured error code
  ErrorCode code = 3;
}

// ValidationWarning represents a non-blocking validation warning.
message ValidationWarning {
  // Field name that caused the warning
  string field = 1;
  // Human-readable warning message
  string message = 2;
  // Structured warning code
  ValidationWarningCode code = 3;
}

// ValidationWarningCode for non-blocking validation warnings.
enum ValidationWarningCode {
  // Default unspecified warning
  VALIDATION_WARNING_CODE_UNSPECIFIED = 0;
  // Position concentration risk
  VALIDATION_WARNING_CODE_HIGH_CONCENTRATION = 1;
  // Unusually large order
  VALIDATION_WARNING_CODE_UNUSUAL_SIZE = 2;
  // Price far from current market
  VALIDATION_WARNING_CODE_FAR_FROM_MARKET = 3;
  // Low liquidity in symbol
  VALIDATION_WARNING_CODE_LOW_LIQUIDITY = 4;
  // High volatility warning
  VALIDATION_WARNING_CODE_HIGH_VOLATILITY = 5;
}
